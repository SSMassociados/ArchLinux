 A LISTA DE PACOTES QUE INSTALEI EM MEU SISTEMA

Cria uma lista de pacotes que instalei dos reposit√≥rios oficiais.
pacman -Qqen > pkglist.txt 

Cria uma lista de pacotes que instalei do AUR.
pacman -Qqem > pkglist_aur.txt 

Combina as duas listas acima em um √∫nico arquivo.
cat pkglist.txt pkglist_aur.txt > pkglist_full.txt 

Esses comandos s√£o bastante simples, mas podem ser irritantes de digitar constantemente. Recomendo aos usu√°rios que criem um alias que emita esses comandos como uma sequ√™ncia.

Seu .zshrc faz o truque:

alias packup='pacman -Qqen > pkglist.txt && pacman -Qqem > pkglist_aur.txt && cat pkglist.txt pkglist_aur.txt > pkglist_full.txt'


LISTA DE PACOTES INSTALADOS

Manter uma lista de todos os pacotes instalados explicitamente pode ser √∫til para, por exemplo, servidor de backup de um sistema ou acelerar a instala√ß√£o em um novo sistema:

pacman -Qqe > pkglist.txt

INSTALAR PACOTES DE UMA LISTA

Para instalar pacotes de uma lista salva anteriormente de pacotes, sem reinstalar pacotes j√° instalados(--needed) que j√° est√£o atualizados, execute:

pacman -S --needed - < pkglist.txt

Para manter uma lista atualizada de pacotes explicitamente instalados (p. ex., em combina√ß√£o com um /etc/ versionado), voc√™ pode configurar um hook. Exemplo:

sudo nano /etc/pacman.d/hooks/backup_list_apps.hook 

[Trigger]
Operation = Install
Operation = Remove
Type = Package
Target = *

[Action]
When = PostTransaction
Exec = /bin/sh -c '/usr/bin/pacman -Qqe > /etc/pkglist.txt'


REMOVENDO PACOTES N√ÉO USADOS (√ìRF√ÉOS)

Para remover recursivamente √≥rf√£os e seus arquivos de configura√ß√£o: 

pacman -Qtdq | pacman -Rns -
pacman -Rns $(pacman -Qtdq)

DESINSTALANDO PROGRAMAS
sudo pacman -Rsn nome_pacote

Quando voc√™ instala e remove pacotes no Arch Linux, alguns pacotes √≥rf√£os n√£o usados ‚Äã‚Äãpodem permanecer em seu sistema. Vc esta querendo remover os pacotes √≥rf√£os ?

pacman -Qtd  //lista os pacotes √≥rf√£os

Verifica a lista, caso queria deletar toda a lista de uma vez.

pacman -Rsn $(pacman - Qdtq)   //remove toda a lista de pacotes √≥rf√£os, ou seja, aqueles que ja n√£o s√£o dependentes de nenhum outro pacote.

pacman -Sc    //limpa os pacotes antigos do cache que n√£o est√£o instalado

pacman -Scc   //limpa todo o cache, sejam eles instalados ou desinstalados

Tenha cuidado ao usar este comando. N√£o h√° como recuperar os pacotes armazenados em cache depois de apagados.

KEEPINSTALLED & KEEPCURRENT

üöÄÔ∏è Se definida como KeepInstalled (o padr√£o), a opera√ß√£o -Sc limpar√° os pacotes que n√£o est√£o mais instalados (n√£o presentes na base de dados local).

CleanMethod = KeepInstalled  

üöÄÔ∏è Se definida como KeepCurrent, -Sc limpa pacotes desatualizados (n√£o presentes em nenhuma base de dados de sincroniza√ß√£o).

CleanMethod = KeepCurrent

üöÄÔ∏è Se os dois valores forem especificados, os pacotes ser√£o limpos apenas se n√£o estiverem instalados localmente e n√£o estiverem presentes em nenhuma base de dados de sincroniza√ß√£o conhecida.

CleanMethod = KeepInstalled &| KeepCurrent

 === > LIMPE O CACHE DO PACOTE NO ARCH LINUX USANDO PACCACHE
 
sudo pacman -S pacman-contrib

Para ver as op√ß√µes dispon√≠veis, consulte o menu de ajuda de paccache.

paccache -h

1. Primeiro, verifique primeiro quantos pacotes em cache est√£o dispon√≠veis na minha pasta de cache.

sudo ls /var/cache/pacman/pkg/ | wc -l

2. Verificar o espa√ßo total em disco usado pela pasta de cache

du -sh /var/cache/pacman/pkg/

3. Para limpar todos os pacotes, exceto as 3 vers√µes mais recentes, execute o seguinte comando:

sudo paccache -r

4. Ainda deseja remover mais pacotes? Claro que voc√™ pode! O Paccache permite que voc√™ decida quantas vers√µes recentes deseja manter.

Por exemplo, execute o seguinte comando se quiser manter apenas uma vers√£o mais recente:

$ sudo paccache -rk1

5. Para remover todas as vers√µes em cache de pacotes desinstalados, execute novamente o paccache com o usinalizador:

$ sudo paccache -ruk0

Onde, uflag indica os pacotes desinstalados.


 === > COMO LIMPAR O ARCH LINUX

Cada sistema fica confuso mais cedo ou mais tarde e o Arch Linux n√£o √© a exce√ß√£o. Portanto, neste artigo, voc√™ aprender√° como limpar seu sistema Arch Linux.

INTRODU√á√ÉO

Embora o Arch Linux ocupe pouco espa√ßo em disco logo ap√≥s a instala√ß√£o, com o passar do tempo ele cresce bastante. Portanto, se voc√™ n√£o tem mais espa√ßo livre em seu computador ou apenas gostaria de manter seu sistema Arch Linux limpo, este post √© tudo que voc√™ precisa.

NOTE que gostaria de avis√°-lo que voc√™ pode danificar seu sistema se cometer um erro durante esses procedimentos. Portanto, fa√ßa backup de todos os seus arquivos antes de fazer qualquer coisa no sistema.


PASSOS PARA LIMPAR O ARCH LINUX

1. Limpe o cache do pacote

Pacman, um gerenciador de pacotes do Arch Linux, armazena todos os pacotes baixados /var/cache/pacman/pkg/e n√£o remove as vers√µes antigas ou desinstaladas automaticamente. Voc√™ pode pensar que isso √© um erro, mas isso √© feito deliberadamente. Isso permite fazer o downgrade de um pacote sem a necessidade de recuperar a vers√£o anterior por meio do Arch Linux Archive. Ou, se desinstalar um programa, voc√™ pode reinstal√°-lo facilmente sem um novo download. Se voc√™ tiver uma conex√£o lenta com a Internet, isso pode ser √∫til. Por exemplo, voc√™ pode simplesmente instalar um pacote deste diret√≥rio usando o comando abaixo.

sudo pacman -U /var/cache/pacman/pkg/packagename

No entanto, essa /var/cache/pacman/pkg/ pode aumentar indefinidamente de tamanho.

Portanto, voc√™ precisa limp√°-lo de vez em quando. Existem duas maneiras de fazer isso: manualmente e automaticamente .

üöÄÔ∏è Limpando o cache manualmente

Voc√™ pode limpar o cache manualmente. Por exemplo, normalmente movo esses arquivos para meu antigo disco r√≠gido, que uso apenas para armazenar dados. Dessa forma, sempre posso acessar esses arquivos, mas eles n√£o ocupam espa√ßo valioso no meu sistema.

No entanto, se voc√™ n√£o tiver espa√ßo extra para armazenar esses pacotes, poder√° remov√™-los sem fazer backup. Uma op√ß√£o √© remover pacotes em cache que n√£o est√£o instalados atualmente:

sudo pacman -Sc

A outra op√ß√£o √© remover todos os pacotes do cache, incluindo aqueles que est√£o instalados:

sudo pacman -Scc

E se acontecer de voc√™ precisar de alguns desses pacotes depois de remov√™-los, voc√™ pode ir para Arch Package Archive e baix√°-los manualmente. Esta n√£o √© uma solu√ß√£o ideal se voc√™ precisar baixar muitos pacotes, porque baix√°-los manualmente levar√° algum tempo, mas ainda √© poss√≠vel.

üöÄÔ∏è Limpando o cache automaticamente

 Outra forma de limpar o /var/cache/pacman/pkg/  √© usar um script que exclui automaticamente todas as vers√µes em cache de pacotes instalados e desinstalados, exceto as 3 vers√µes mais recentes. O script √© chamado paccache. Voc√™ pode instal√°-lo com o pacman-contrib

sudo pacman -S pacman-contrib

Para ver as op√ß√µes dispon√≠veis, consulte o menu de ajuda de paccache.

paccache -h

Por exemplo, voc√™ pode execut√°-lo no modo seco para ver quantos pacotes ser√£o removidos usando a -dop√ß√£o. Em seguida, voc√™ pode executar uma limpeza real usando a op√ß√£o -r.

EXECUTAR PACCACHE MENSALMENTE

Uma maneira muito √∫til de usar esse script √© execut√°-lo automaticamente uma vez por m√™s usando o cron√¥metro do systemd . Basicamente, voc√™ precisa criar o arquivo paccache.timerem /etc/systemd/system/, que ser√° acionado /usr/lib/systemd/system/paccache.service.

Ent√£o, voc√™ cria um paccache.timer arquivo com o nano:

sudo nano /etc/systemd/system/paccache.timer

Em seguida, para executar este script mensalmente, cole o seguinte conte√∫do neste arquivo:

[Unit]
Description=Clean-up old pacman pkg

[Timer]
OnCalendar=monthly
Persistent=true

[Install]
WantedBy=multi-user.target
Depois disso, inicie o servi√ßo systemd:

sudo systemctl enable paccache.timer
sudo systemctl start paccache.timer

Finalmente, voc√™ pode verificar o status do servi√ßo.

sudo systemctl status paccache.timer

Ent√£o, voc√™ deve ver a mensagem de que ele est√° ativo. Agora, paccache ser√° executado todo m√™s e limpar√° o cache de seus pacotes antigos e desinstalados.

üöÄÔ∏è CORRER PACCACHE ATR√ÅS PACMAN

Como alternativa a este cron√¥metro, voc√™ tamb√©m pode correr paccachesempre depois de correr pacman. Ent√£o, voc√™ precisa criar um Gancho para isso. 

Basta criar um arquivo /etc/pacman.d/hooks/clean_package_cache.hook.

Para fazer isso, crie um arquivo /etc/pacman.d/hooks/clean_package_cache.hook :

sudo mkdir /etc/pacman.d/hooks

sudo nano /etc/pacman.d/hooks/clean_package_cache.hook

Depois disso, adicione esse conte√∫do ao arquivo.

[Trigger]
Operation = Upgrade
Operation = Install
Operation = Remove
Type = Package
Target = *

[Action]
Description = Cleaning pacman cache with paccache ‚Ä¶
When = PostTransaction
Exec = /usr/bin/paccache -r

Agora, se eu remover um pacote usando pacman, paccache tamb√©m ser√° executado.


REMOVA OS PACOTES N√ÉO USADOS ‚Äã‚Äã(√ìRF√ÉOS)

Quando voc√™ instala e remove pacotes no Arch Linux, alguns pacotes √≥rf√£os n√£o usados ‚Äã‚Äãpodem permanecer em seu sistema. Para encontr√°-los, voc√™ precisa executar este comando:

sudo pacman -Qtdq

Como voc√™ pode ver, executando o comando acima, voc√™ poder√° saber quais pacotes s√£o √≥rf√£os. Para remov√™-los, voc√™ precisa modificar o comando com a a√ß√£o remove:

sudo pacman -Rns $(pacman -Qtdq)

Agora, voc√™ sabe como limpar os arquivos de sistema do Arch Linux removendo o cache do pacote e removendo os pacotes √≥rf√£os. No entanto, ainda h√° mais coisas a serem feitas em sua pasta de in√≠cio.

LIMPE O CACHE EM SEU DIRET√ìRIO /HOME

Nesta etapa, vou mostrar como limpar o Arch Linux removendo os arquivos de cache em sua /home/userpasta.

Conforme usamos nosso sistema, o cache vai encher e ocupar muito espa√ßo. Portanto, a primeira coisa que voc√™ provavelmente deseja fazer √© limpar o cache no diret√≥rio do usu√°rio. Se quiser verificar o tamanho da pasta de cache, voc√™ pode fazer isso com este comando:

sudo du -sh ~/.cache/

Para limp√°-lo, voc√™ precisa remover todos os arquivos dentro dele:

rm -rf ~/.cache/*

REMOVA OS ARQUIVOS DE CONFIGURA√á√ÉO ANTIGOS

Os arquivos de configura√ß√£o de diferentes programas s√£o armazenados em ~/.config/. Voc√™ pode acess√°-lo a partir do seu gerenciador de arquivos e verificar se h√° algum arquivo de configura√ß√£o remanescente dos programas que voc√™ desinstalou. Basta selecionar essas pastas e exclu√≠-las. Mas antes de remover qualquer arquivo, gostaria de lembrar que √© melhor fazer um backup de todos os seus arquivos antes de remover qualquer coisa.

A pasta .config √© onde os arquivos de configura√ß√£o est√£o
Os arquivos de configura√ß√£o em ~/.config

Alguns arquivos antigos tamb√©m podem estar armazenados ~/.local/share/. Verifique tamb√©m e exclua alguns arquivos e pastas, se necess√°rio.

REMOVA DUPLICATAS, ARQUIVOS VAZIOS, DIRET√ìRIOS VAZIOS E LINKS SIMB√ìLICOS QUEBRADOS
VOC√ä PODE FAZER AINDA MAIS LIMPEZA REMOVENDO ARQUIVOS E DIRET√ìRIOS DUPLICADOS E VAZIOS.

Para manter alguma ordem em seu sistema, eu tamb√©m recomendo remover links simb√≥licos quebrados, ei links que levam a arquivos ou pastas inexistentes. Eles n√£o ocupam muito espa√ßo, mas desorganizam o seu sistema. Para remover essas coisas, voc√™ pode usar o programa rmlint.

Instale-o:

sudo pacman -S rmlint

Se voc√™ marcar todas as suas op√ß√µes com --help, ver√° que s√£o muitas. Eu recomendo explor√°-los.

No entanto, usar este aplicativo √© bastante simples, voc√™ pode execut√°-lo especificando o diret√≥rio no qual deseja verificar se h√° arquivos duplicados. Por exemplo:

rmlint /home/alu

Este programa listar√° tudo o que encontrar e criar√° um script de shell para remover esse lint. O script pode ser encontrado na pasta inicial. Abra-o usando um editor de texto, role para baixo e verifique quais arquivos ele remover√°.

Voc√™ pode remover alguns desses arquivos manualmente ou, se concordar com a a√ß√£o de remo√ß√£o sugerida, pode voltar ao terminal e executar este script. Novamente, certifique-se de fazer um backup de todos os arquivos antes de executar este script. Esta a√ß√£o ser√° irrevers√≠vel.

sh -c rmlint.sh

Agora, seu sistema est√° mais limpo. Mas n√£o √© o fim, ainda h√° algumas coisas que voc√™ pode fazer para limp√°-lo ainda mais.

ENCONTRE OS MAIORES ARQUIVOS E DIRET√ìRIOS

Voc√™ pode verificar quais s√£o os maiores arquivos em seu sistema e talvez n√£o precise deles. Para realizar essa tarefa, voc√™ pode usar algumas ferramentas de linha de comando ou programas gr√°ficos. Para a ferramenta de linha de comando , eu uso ncdu.

Para instal√°-lo, execute este comando:

sudo pacman -S ncdu

Procure os maiores diret√≥rios e, em seguida, v√° dentro desses diret√≥rios e encontre os maiores arquivos e remova-os se n√£o precisar deles.

Se voc√™ preferir um programa gr√°fico, pode usar filelight para o Plasma 5 . Ele mostra um resumo gr√°fico de todos os discos r√≠gidos e voc√™ pode entrar e verificar os diret√≥rios, depois entrar nos diret√≥rios maiores e assim por diante at√©.

Se voc√™ estiver usando o Gnome , pode instalar baobab. Existem algumas outras ferramentas listadas no Arch Wiki . Escolha o que quiser.

PROGRAMAS DE LIMPEZA DE DISCO

Existem tamb√©m alguns programas de limpeza de disco que podem realizar muitas das tarefas listadas acima automaticamente. No entanto, como voc√™ usa o Arch Linux, n√£o recomendo o uso desses programas. Nem sempre √© √≥bvio o que exatamente ser√° feito e voc√™ n√£o tem controle total do seu sistema. Al√©m disso, voc√™ pode excluir facilmente alguns arquivos de configura√ß√£o que n√£o deseja excluir.

Mas eu ainda gostaria de compartilhar com voc√™s esta op√ß√£o, pois alguns usu√°rios ainda podem preferir o pacote completo para limpeza do sistema.

Entre todos os programas de limpeza autom√°tica no Arch Linux, Bleachbit √© provavelmente o mais popular. Ele tem uma interface gr√°fica agrad√°vel e pode fazer a maioria das coisas que mostrei acima. Por exemplo, voc√™ pode limpar o cache do sistema. Basta selecion√°-lo e clicar no bot√£o limpar.

Confira as outras op√ß√µes do Bleachbit. Eu acredito que a maioria deles s√£o autoexplicativos.

LIMPE O DI√ÅRIO DO SYSTEMD

O Systemd armazena seus logs /var/log/journal/ e esses logs podem ser muito √∫teis, conforme descrevi em minha postagem em 10 coisas a fazer primeiro ap√≥s instalar o Arch Linux . No entanto, esses arquivos de log podem ocupar at√© 10% do tamanho do seu sistema por padr√£o. Existem duas solu√ß√µes para limitar esse tamanho.

Voc√™ pode limpar esses arquivos de log manualmente quando ficar sem espa√ßo. Voc√™ pode manter apenas os registros mais recentes por limite de tamanho (por exemplo, manter apenas 50 MB dos registros mais recentes):

sudo journalctl --vacuum-size=50M

Ou por limite de tempo (por exemplo, √∫ltimas 4 semanas):

sudo journalctl --vacuum-time=4weeks

Voc√™ tamb√©m pode definir esse limite como permanente e nunca se preocupar em limpar os registros. Basta editar o arquivo /etc/systemd/journald.confremovendo o coment√°rio SystemMaxUse=e definindo o limite de tamanho:
SystemMaxUse=50M

√â isso que escolhi fazer e √© por isso que perdi esse ponto quando escrevi este artigo originalmente. Simplesmente nunca experimentei grandes arquivos journalctl.

